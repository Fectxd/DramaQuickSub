<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>双语字幕编辑器</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="sidebar">
        <h3>剧集列表</h3>
        <div id="episode-list"></div>
    </div>
    <div id="main">
        <button class="btn-about-icon" onclick="showAbout()" title="关于 DramaQuickSub">ℹ️</button>
        <div id="toolbar">
            <!-- 字幕导入区 -->
            <div class="toolbar-section">
                <label class="section-label">字幕导入</label>
                <div class="section-content">
                    <input type="file" id="zh-zip" accept=".zip" style="display:none">
                    <button class="btn-upload btn-zh" onclick="console.log('Button clicked'); document.getElementById('zh-zip').click();">📁 上传中文</button>
                    
                    <input type="file" id="en-zip" accept=".zip" style="display:none">
                    <button class="btn-upload btn-en" onclick="console.log('Button clicked'); document.getElementById('en-zip').click();">📁 上传外语</button>
                </div>
            </div>
            
            <!-- 视频配置区 -->
            <div class="toolbar-section">
                <label class="section-label">视频配置</label>
                <div class="section-content">
                    <input type="text" id="video-path" placeholder="视频文件夹绝对路径">
                    <button class="btn-match" onclick="matchFiles()">🔗 匹配</button>
                    <button class="btn-refresh" onclick="rematchVideos()" title="重新扫描视频文件夹并更新视频关联">🔄 刷新</button>
                </div>
            </div>
            
            <!-- 操作区 -->
            <div class="toolbar-section">
                <label class="section-label">编辑操作</label>
                <div class="section-content action-buttons-group">
                    <button class="btn-save" onclick="saveAll()">💾 保存</button>
                    <button class="btn-ai" onclick="correctCurrent()">🤖 AI修正</button>
                    <button class="btn-export" onclick="exportEn()">📤 导出</button>
                </div>
            </div>
        </div>
        <div id="workspace">
            <div id="video-container">
                <video id="player" controls></video>
                <div id="video-placeholder">请选择剧集加载视频</div>
                <div id="subtitle-overlay"></div>
            </div>
            <div id="editor-container">
                <div id="editor-header">
                    <span id="current-episode-info">请先匹配文件并选择剧集</span>
                    <div id="primary-switch" style="display: none;">
                        <label style="font-size: 12px; margin-right: 8px;">排序依据:</label>
                        <select id="primary-lang" onchange="switchPrimary()">
                            <option value="union">并集</option>
                            <option value="zh">中文块</option>
                            <option value="en">外语块</option>
                        </select>
                    </div>
                </div>
                <div id="subtitle-blocks"></div>
            </div>
        </div>
    </div>
    
    <!-- 手动分轴模态窗口 -->
    <div id="split-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>手动分轴</h3>
                <button class="modal-close" onclick="closeSplitModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="split-video-container">
                    <video id="split-video" controls></video>
                    <div id="split-subtitle-display"></div>
                </div>
                <div id="split-original-content">
                    <div class="split-original-section">
                        <div class="split-original-header">
                            <strong>原始中文字幕</strong>
                            <button class="btn-copy" onclick="copyToClipboard('split-zh-text')">📋 复制</button>
                        </div>
                        <div id="split-zh-text" class="split-original-text"></div>
                    </div>
                    <div class="split-original-section">
                        <div class="split-original-header">
                            <strong>原始外文字幕</strong>
                            <button class="btn-copy" onclick="copyToClipboard('split-en-text')">📋 复制</button>
                        </div>
                        <div id="split-en-text" class="split-original-text"></div>
                    </div>
                </div>
                <div id="split-controls">
                    <div class="split-info">
                        <span id="split-time-info">00:00:00 / 00:00:00</span>
                        <button onclick="addSplitPoint()" class="btn-add-split">在当前位置添加分割点</button>
                    </div>
                    <div id="split-timeline">
                        <div id="split-progress"></div>
                        <div id="split-markers"></div>
                    </div>
                    <div id="split-segments"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveSplit()" class="btn-primary">保存分割</button>
                <button onclick="closeSplitModal()" class="btn-secondary">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 自定义确认对话框 -->
    <div id="custom-confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirm-title">确认</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message" style="padding: 20px; font-size: 14px;"></p>
            </div>
            <div class="modal-footer">
                <button id="confirm-ok-btn" class="btn-primary">确定</button>
                <button id="confirm-cancel-btn" class="btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 自定义提示对话框 -->
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="alert-title">提示</h3>
            </div>
            <div class="modal-body">
                <p id="alert-message" style="padding: 20px; font-size: 14px;"></p>
            </div>
            <div class="modal-footer">
                <button id="alert-ok-btn" class="btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- 关于对话框 -->
    <div id="about-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>关于 DramaQuickSub</h3>
                <button class="modal-close" onclick="closeAbout()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="about-content">
                    <div class="about-icon">
                        <img src="https://github.com/user-attachments/assets/e4864d24-e61e-4fa3-a958-8dc124d568f3" alt="DramaQuickSub" width="80" height="80">
                    </div>
                    <div class="about-title">DramaQuickSub 字幕编辑器</div>
                    <div class="about-version">版本 1.0.0</div>
                    <div class="about-description">
                        一个快速高效的影视剧双语字幕编辑工具，支持中英文字幕对齐、智能纠错和批量处理。
                    </div>
                    <div class="about-divider"></div>
                    <div class="about-info">
                        <div class="about-info-row">
                            <span class="about-label">作者：</span>
                            <span>Fectxd</span>
                        </div>
                        <div class="about-info-row">
                            <span class="about-label">单位：</span>
                            <span>Universidad de Sevilla</span>
                        </div>
                        <div class="about-info-row">
                            <span class="about-label">专业：</span>
                            <span>西班牙语翻译</span>
                        </div>
                        <div class="about-info-row">
                            <span class="about-label">GitHub：</span>
                            <a href="https://github.com/Fectxd" target="_blank">github.com/Fectxd</a>
                        </div>
                        <div class="about-info-row">
                            <span class="about-label">邮箱：</span>
                            <a href="mailto:fectxd@qq.com">fectxd@qq.com</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAbout()" class="btn-primary">关闭</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
